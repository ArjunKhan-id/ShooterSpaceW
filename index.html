<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>ShooterSpaceW - Login / Register</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
    font-family: 'Poppins', sans-serif;
    color: #f0f0f0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #container {
    background: rgba(15,15,15,0.85);
    border-radius: 15px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.6);
    width: 320px;
    padding: 30px 30px 40px;
    max-height: 600px;
    overflow-y: auto;
  }
  h2 {
    text-align: center;
    font-weight: 600;
    margin-bottom: 25px;
    letter-spacing: 1.1px;
    text-transform: uppercase;
    color: #00ffd8;
  }
  label {
    display: block;
    margin-bottom: 6px;
    font-weight: 500;
    font-size: 0.9rem;
    color: #a0f9f3;
  }
  input[type="text"],
  input[type="email"],
  input[type="password"],
  input[type="number"] {
    width: 100%;
    padding: 10px 14px;
    margin-bottom: 18px;
    border: none;
    border-radius: 6px;
    background-color: #142c34;
    color: #d9faff;
    font-size: 1rem;
    transition: background-color 0.3s;
  }
  input[type="text"]:focus,
  input[type="email"]:focus,
  input[type="password"]:focus,
  input[type="number"]:focus {
    outline: none;
    background-color: #1e434c;
  }
  button {
    width: 100%;
    background: #00ffd8;
    color: #0b2a2f;
    font-weight: 600;
    font-size: 1.1rem;
    padding: 12px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    margin-bottom: 15px;
    transition: background 0.3s;
  }
  button:hover:not(:disabled) {
    background: #00c9b1;
  }
  button:disabled {
    background: #555;
    cursor: not-allowed;
  }
  #toggle-form {
    background: transparent;
    color: #00ffd8;
    border: none;
    cursor: pointer;
    font-size: 0.9rem;
    text-decoration: underline;
    margin-top: 5px;
    width: 100%;
  }

  .otp-container {
    display: flex;
    gap: 10px;
    align-items: center;
    margin-bottom: 18px;
  }
  .otp-container input {
    flex-grow: 1;
    margin-bottom: 0;
  }
  .otp-container button {
    flex-grow: 0;
    width: 100px;
    padding: 10px;
    font-size: 0.9rem;
  }

  @media (max-width: 400px) {
    #container {
      width: 95vw;
      max-height: 580px;
      padding: 25px 20px 30px;
    }
  }
</style>
<!-- SweetAlert2 CSS -->
<link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet"/>
</head>
<body>

<div id="container">
  <h2 id="form-title">Register ShooterSpaceW</h2>
  <form id="auth-form" novalidate>
    <label for="username" id="label-username">Username</label>
    <input type="text" id="username" autocomplete="username" minlength="3" maxlength="20" placeholder="Your username" />

    <label for="email">Email</label>
    <input type="email" id="email" autocomplete="email" placeholder="email@example.com" />

    <label for="confirm-email" id="label-confirm-email">Confirm Email (send OTP)</label>
    <div class="otp-container" id="otp-container">
      <input type="email" id="confirm-email" autocomplete="email" placeholder="Confirm your email for OTP" />
      <button type="button" id="send-otp-btn">Send OTP</button>
    </div>

    <label for="otp" id="label-otp">Enter OTP</label>
    <input type="number" id="otp" placeholder="6-digit OTP" maxlength="6" />

    <label for="password">Password</label>
    <input type="password" id="password" autocomplete="current-password" minlength="6" placeholder="Password (min 6 chars)" />

    <button type="submit" id="submit-btn" disabled>Register</button>
  </form>

  <button id="toggle-form">Already have an account? Login</button>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

<!-- EmailJS SDK -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<!-- SweetAlert2 JS -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
  // Initialize EmailJS (Replace YOUR_EMAILJS_USER_ID with your EmailJS user ID)
  emailjs.init("
ZMLQ7jZCVJi1ssffU");

  // Firebase config - REPLACE with your Firebase project config
  const firebaseConfig = {
  apiKey: "AIzaSyCLDqFv1kiOFG4xH8XR-lUyW_j-FbBp8aM",
  authDomain: "shooterspacew.firebaseapp.com",
  databaseURL: "https://shooterspacew-default-rtdb.firebaseio.com",
  projectId: "shooterspacew",
  storageBucket: "shooterspacew.firebasestorage.app",
  messagingSenderId: "780477534762",
  appId: "1:780477534762:web:26a98d067ebca133e8a953",
  measurementId: "G-CLTY47FSSZ"
};

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  // Form elements references
  const form = document.getElementById('auth-form');
  const usernameInput = document.getElementById('username');
  const emailInput = document.getElementById('email');
  const confirmEmailInput = document.getElementById('confirm-email');
  const otpInput = document.getElementById('otp');
  const passwordInput = document.getElementById('password');
  const sendOtpBtn = document.getElementById('send-otp-btn');
  const submitBtn = document.getElementById('submit-btn');
  const toggleFormBtn = document.getElementById('toggle-form');
  const formTitle = document.getElementById('form-title');
  const otpContainer = document.getElementById('otp-container');
  const labelUsername = document.getElementById('label-username');
  const labelConfirmEmail = document.getElementById('label-confirm-email');
  const labelOtp = document.getElementById('label-otp');

  let isLoginMode = false;
  let generatedOtp = null;
  let otpVerified = false;

  function clearMessage() {
    // We no longer have in-page messages, so no action here.
  }
  function showSuccess(message) {
    Swal.fire({
      icon: 'success',
      title: 'Success',
      text: message,
      timer: 2500,
      showConfirmButton: false,
    });
  }
  function showError(message) {
    Swal.fire({
      icon: 'error',
      title: 'Error',
      text: message,
    });
  }
  function showInfo(message) {
    Swal.fire({
      icon: 'info',
      title: 'Info',
      text: message,
      timer: 1800,
      showConfirmButton: false,
    });
  }

  // Generate 6-digit OTP
  function generateOtp() {
    return Math.floor(100000 + Math.random() * 900000).toString();
  }

  function resetOtpState() {
    generatedOtp = null;
    otpVerified = false;
    otpInput.value = '';
    submitBtn.disabled = true;
  }

  // Validate form inputs and enable/disable submit button
  function validateForm() {
    if (isLoginMode) {
      if (validateEmail(emailInput.value) && passwordInput.value.length >= 6) {
        submitBtn.disabled = false;
      } else {
        submitBtn.disabled = true;
      }
    } else {
      if (
        usernameInput.value.trim().length >= 3 &&
        validateEmail(emailInput.value) &&
        otpVerified &&
        passwordInput.value.length >= 6
      ) {
        submitBtn.disabled = false;
      } else {
        submitBtn.disabled = true;
      }
    }
  }

  function validateEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
  }

  // Send OTP email via EmailJS
  function sendOtpEmail(email, otp) {
    return emailjs.send('service_8fsbu8n', 'template_g46cxyi', {
      to_email: email,
      otp_code: otp,
    });
  }

  sendOtpBtn.addEventListener('click', () => {
    const email = confirmEmailInput.value.trim();
    if (!validateEmail(email)) {
      showError('Please enter a valid confirm email for OTP.');
      return;
    }
    if (email !== emailInput.value.trim()) {
      showError('Confirm email must match the email entered above.');
      return;
    }
    generatedOtp = generateOtp();
    sendOtpBtn.disabled = true;
    sendOtpBtn.textContent = 'Sending...';
    sendOtpEmail(email, generatedOtp)
      .then(() => {
        showSuccess('OTP sent! Check your email.');
        sendOtpBtn.textContent = 'Resend OTP';
        validateForm();
      })
      .catch(() => {
        showError('Failed to send OTP. Please try again.');
        generatedOtp = null;
        sendOtpBtn.textContent = 'Send OTP';
      })
      .finally(() => {
        sendOtpBtn.disabled = false;
      });
  });

  otpInput.addEventListener('input', () => {
    if (!generatedOtp) {
      otpVerified = false;
      validateForm();
      return;
    }
    const userOtp = otpInput.value.trim();
    if (userOtp.length === 6) {
      if (userOtp === generatedOtp) {
        otpVerified = true;
        showSuccess('OTP verified successfully!');
      } else {
        otpVerified = false;
        showError('Invalid OTP. Please try again.');
      }
    } else {
      otpVerified = false;
    }
    validateForm();
  });

  toggleFormBtn.addEventListener('click', () => {
    isLoginMode = !isLoginMode;
    resetOtpState();
    form.reset();

    if (isLoginMode) {
      formTitle.textContent = 'Login ShooterSpaceW';

      usernameInput.style.display = 'none';
      labelUsername.style.display = 'none';

      otpContainer.style.display = 'none';
      confirmEmailInput.style.display = 'none';
      labelConfirmEmail.style.display = 'none';

      otpInput.style.display = 'none';
      labelOtp.style.display = 'none';

      submitBtn.textContent = 'Login';
      toggleFormBtn.textContent = "Don't have an account? Register";

      emailInput.setAttribute('autocomplete', 'email');
      passwordInput.setAttribute('autocomplete', 'current-password');
    } else {
      formTitle.textContent = 'Register ShooterSpaceW';

      usernameInput.style.display = 'block';
      labelUsername.style.display = 'block';

      otpContainer.style.display = 'flex';
      confirmEmailInput.style.display = 'block';
      labelConfirmEmail.style.display = 'block';

      otpInput.style.display = 'block';
      labelOtp.style.display = 'block';

      submitBtn.textContent = 'Register';
      toggleFormBtn.textContent = 'Already have an account? Login';

      emailInput.setAttribute('autocomplete', 'email');
      passwordInput.setAttribute('autocomplete', 'new-password');
    }
    validateForm();
  });

  [usernameInput, emailInput, confirmEmailInput, otpInput, passwordInput].forEach((input) => {
    input.addEventListener('input', () => {
      if (!isLoginMode && (input === confirmEmailInput)) {
        resetOtpState();
      }
      validateForm();
    });
  });

  form.addEventListener('submit', (e) => {
    e.preventDefault();

    const username = usernameInput.value.trim();
    const email = emailInput.value.trim();
    const password = passwordInput.value;

    if (isLoginMode) {
      auth.signInWithEmailAndPassword(email, password)
        .then(userCredential => {
          showSuccess('Login successful! Redirecting...');
          setTimeout(() => {
            Swal.fire({
              icon: 'success',
              title: 'Welcome back!',
              text: `You are now logged in to ShooterSpaceW as ${userCredential.user.email}`,
              confirmButtonText: 'OK',
            }).then(() => {
              form.reset();
              resetOtpState();
            });
          }, 1500);
        })
        .catch(error => {
          switch (error.code) {
            case 'auth/user-not-found':
              showError('User not found. Please register first.');
              break;
            case 'auth/wrong-password':
              showError('Incorrect password. Please try again.');
              break;
            case 'auth/invalid-email':
              showError('Invalid email format.');
              break;
            default:
              showError(`Login error: ${error.message}`);
          }
        });
    } else {
      if (!otpVerified) {
        showError('Please verify OTP before registering.');
        return;
      }
      auth.createUserWithEmailAndPassword(email, password)
        .then(userCredential => {
          const user = userCredential.user;
          user.updateProfile({ displayName: username }).then(() => {
            showSuccess('Registration successful! You can now login.');
            form.reset();
            resetOtpState();
            toggleFormBtn.click();
          });
        })
        .catch(error => {
          switch (error.code) {
            case 'auth/email-already-in-use':
              showError('Email already in use. Please login.');
              break;
            case 'auth/invalid-email':
              showError('Invalid email format.');
              break;
            case 'auth/weak-password':
              showError('Weak password. Minimum 6 characters.');
              break;
            default:
              showError(`Registration error: ${error.message}`);
          }
        });
    }
  });

  // Initialize page - default to Register mode
  toggleFormBtn.click();

</script>

</body>
</html>