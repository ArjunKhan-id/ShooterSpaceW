<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>ShooterSpaceW - Login / Register</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
    font-family: 'Poppins', sans-serif;
    color: #f0f0f0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #container {
    background: rgba(15,15,15,0.85);
    border-radius: 15px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.6);
    width: 320px;
    padding: 30px 30px 40px;
    max-height: 600px;
    overflow-y: auto;
  }
  h2 {
    text-align: center;
    font-weight: 600;
    margin-bottom: 25px;
    letter-spacing: 1.1px;
    text-transform: uppercase;
    color: #00ffd8;
  }
  label {
    display: block;
    margin-bottom: 6px;
    font-weight: 500;
    font-size: 0.9rem;
    color: #a0f9f3;
  }
  .input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    margin-bottom: 18px;
  }
  input[type="text"],
  input[type="email"],
  input[type="password"],
  input[type="number"] {
    width: 100%;
    padding: 10px 40px 10px 14px; /* padding-right for icon space */
    border: none;
    border-radius: 6px;
    background-color: #142c34;
    color: #d9faff;
    font-size: 1rem;
    transition: background-color 0.3s;
  }
  input[type="text"]:focus,
  input[type="email"]:focus,
  input[type="password"]:focus,
  input[type="number"]:focus {
    outline: none;
    background-color: #1e434c;
  }
  .password-toggle {
    position: absolute;
    right: 12px;
    cursor: pointer;
    width: 24px;
    height: 24px;
    fill: #a0f9f3;
    user-select: none;
  }
  button {
    position: relative;
    width: 100%;
    background: #00ffd8;
    color: #0b2a2f;
    font-weight: 600;
    font-size: 1.1rem;
    padding: 12px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    margin-bottom: 15px;
    transition: background 0.3s;
    overflow: hidden;
  }
  button:hover:not(:disabled) {
    background: #00c9b1;
  }
  button:disabled {
    background: #555;
    cursor: not-allowed;
  }
  #toggle-form {
    background: transparent;
    color: #00ffd8;
    border: none;
    cursor: pointer;
    font-size: 0.9rem;
    text-decoration: underline;
    margin-top: 5px;
    width: 100%;
  }
  .otp-container {
    display: flex;
    gap: 10px;
    align-items: center;
    margin-bottom: 18px;
  }
  .otp-container input {
    flex-grow: 1;
    margin-bottom: 0;
  }
  .otp-container button {
    flex-grow: 0;
    width: 100px;
    padding: 10px;
    font-size: 0.9rem;
  }
  /* Spinner styling */
  .spinner {
    width: 18px;
    height: 18px;
    border: 3px solid rgba(11,42,47, 0.3);
    border-top-color: #0b2a2f;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    position: absolute;
    top: calc(50% - 9px);
    left: calc(50% - 9px);
    display: none;
  }
  button.loading .spinner {
    display: block;
  }
  button.loading span {
    visibility: hidden;
  }
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  @media (max-width: 400px) {
    #container {
      width: 95vw;
      max-height: 580px;
      padding: 25px 20px 30px;
    }
  }
</style>

<!-- SweetAlert2 CSS -->
<link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet" />

</head>
<body>

<div id="container">
  <h2 id="form-title">Register ShooterSpaceW</h2>
  <form id="auth-form" novalidate>
    <label for="email">Email</label>
    <div class="input-wrapper">
      <input type="email" id="email" autocomplete="email" placeholder="email@example.com" />
    </div>

    <label for="password">Password</label>
    <div class="input-wrapper">
      <input type="password" id="password" autocomplete="new-password" minlength="6" placeholder="Password (min 6 chars)" />
      <svg class="password-toggle" id="toggle-password" viewBox="0 0 24 24" tabindex="0" aria-label="Toggle password visibility" role="button" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zm0 12c-2.49 0-4.5-2.01-4.5-4.5S9.51 7.5 12 7.5s4.5 2.01 4.5 4.5-2.01 4.5-4.5 4.5zm0-7a2.5 2.5 0 0 0 0 5 2.5 2.5 0 0 0 0-5z"/>
      </svg>
    </div>

    <label for="confirm-password" id="label-confirm-password" style="display:none;">Confirm Password</label>
    <div class="input-wrapper" style="display:none;" id="confirm-password-wrapper">
      <input type="password" id="confirm-password" autocomplete="new-password" minlength="6" placeholder="Confirm Password" />
      <svg class="password-toggle" id="toggle-confirm-password" viewBox="0 0 24 24" tabindex="0" aria-label="Toggle confirm password visibility" role="button" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zm0 12c-2.49 0-4.5-2.01-4.5-4.5S9.51 7.5 12 7.5s4.5 2.01 4.5 4.5-2.01 4.5-4.5 4.5zm0-7a2.5 2.5 0 0 0 0 5 2.5 2.5 0 0 0 0-5z"/>
      </svg>
    </div>

    <div class="otp-container" id="otp-container">
      <label for="otp" style="margin-bottom:6px; color:#a0f9f3; font-weight:500; font-size:0.9rem;">Enter OTP</label>
      <input type="number" id="otp" placeholder="6-digit OTP" maxlength="6" style="flex-grow:1; margin-bottom: 0;" />
    </div>

    <button type="submit" id="submit-btn"><span>Register</span><div class="spinner"></div></button>
  </form>

  <button id="toggle-form">Already have an account? Login</button>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

<!-- EmailJS SDK -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<!-- SweetAlert2 JS -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
  emailjs.init("ZMLQ7jZCVJi1ssffU");

  const firebaseConfig = {
  apiKey: "AIzaSyCLDqFv1kiOFG4xH8XR-lUyW_j-FbBp8aM",
  authDomain: "shooterspacew.firebaseapp.com",
  databaseURL: "https://shooterspacew-default-rtdb.firebaseio.com",
  projectId: "shooterspacew",
  storageBucket: "shooterspacew.firebasestorage.app",
  messagingSenderId: "780477534762",
  appId: "1:780477534762:web:26a98d067ebca133e8a953",
  measurementId: "G-CLTY47FSSZ"
};
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  const form = document.getElementById('auth-form');
  const emailInput = document.getElementById('email');
  const passwordInput = document.getElementById('password');
  const confirmPasswordInput = document.getElementById('confirm-password');
  const confirmPasswordWrapper = document.getElementById('confirm-password-wrapper');
  const labelConfirmPassword = document.getElementById('label-confirm-password');
  const otpInput = document.getElementById('otp');
  const submitBtn = document.getElementById('submit-btn');
  const submitBtnText = submitBtn.querySelector('span');
  const toggleFormBtn = document.getElementById('toggle-form');
  const formTitle = document.getElementById('form-title');
  const otpContainer = document.getElementById('otp-container');
  const togglePasswordIcon = document.getElementById('toggle-password');
  const toggleConfirmPasswordIcon = document.getElementById('toggle-confirm-password');
  
  let isLoginMode = false;
  let generatedOtp = null;
  let otpVerified = false;

  function showSuccess(message) {
    Swal.fire({
      icon: 'success',
      title: 'Success',
      text: message,
      timer: 2500,
      showConfirmButton: false
    });
  }

  function showError(message) {
    Swal.fire({
      icon: 'error',
      title: 'Error',
      text: message,
    });
  }

  function validateEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email.trim());
  }

  function resetOtpState() {
    generatedOtp = null;
    otpVerified = false;
    otpInput.value = '';
    submitBtn.disabled = true;
  }

  function validateForm() {
    if (isLoginMode) {
      submitBtn.disabled = !(validateEmail(emailInput.value) && passwordInput.value.length >= 6);
    } else {
      const passwordsMatch = passwordInput.value === confirmPasswordInput.value && confirmPasswordInput.value.length >= 6;
      submitBtn.disabled = !(validateEmail(emailInput.value) && otpVerified && passwordInput.value.length >= 6 && passwordsMatch);
    }
  }

  // Toggle password visibility helpers
  function togglePasswordVisibility(inputElement, iconElement) {
    if (inputElement.type === "password") {
      inputElement.type = "text";
      iconElement.innerHTML = eyeSlashSVG;
    } else {
      inputElement.type = "password";
      iconElement.innerHTML = eyeSVG;
    }
  }

  const eyeSVG = `<path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zm0 12c-2.49 0-4.5-2.01-4.5-4.5S9.51 7.5 12 7.5s4.5 2.01 4.5 4.5-2.01 4.5-4.5 4.5zm0-7a2.5 2.5 0 0 0 0 5 2.5 2.5 0 0 0 0-5z"/>`;
  const eyeSlashSVG = `<path d="M12 6.5c3.05 0 5.71 1.47 7.27 3.75a11.243 11.243 0 0 1-1.64 1.88l1.44 1.44a13.221 13.221 0 0 0 2.08-2.17A14.341 14.341 0 0 0 12 5.5c-1.59 0-3.11.35-4.5 1l1.44 1.44A5.41 5.41 0 0 1 12 6.5zM2.1 3.51 1 4.61l3.74 3.74A11.8 11.8 0 0 0 1 12c1.83 3.77 6.48 7.5 11 7.5.92 0 1.84-.16 2.7-.45l2.61 2.61 1.11-1.11L2.1 3.5zM12 17.5c-2.43 0-4.41-1.87-4.49-4.27l4.76 4.76c-.13.01-.27.01-.4.01zm5.51-3.19-1.75-1.75A4.5 4.5 0 0 1 12 8.5c.7 0 1.37.17 1.94.47l-1.71-1.71a6.47 6.47 0 0 0-6.59-1.84c1.82-1 4.1-1.39 6.31-.84a11.936 11.936 0 0 1 4.68 2.23c.28.22.54.45.78.7-.2 1.6-1.15 3.02-2.41 3.94z"/>`;

  togglePasswordIcon.addEventListener('click', () => {
    togglePasswordVisibility(passwordInput, togglePasswordIcon);
  });

  toggleConfirmPasswordIcon.addEventListener('click', () => {
    togglePasswordVisibility(confirmPasswordInput, toggleConfirmPasswordIcon);
  });

  otpInput.addEventListener('input', () => {
    if (!generatedOtp) {
      otpVerified = false;
      validateForm();
      return;
    }
    const userOtp = otpInput.value.trim();
    if (userOtp.length === 6) {
      if (userOtp === generatedOtp) {
        otpVerified = true;
        showSuccess('OTP verified successfully!');
      } else {
        otpVerified = false;
        showError('Invalid OTP. Please try again.');
      }
    } else {
      otpVerified = false;
    }
    validateForm();
  });

  toggleFormBtn.addEventListener('click', () => {
    isLoginMode = !isLoginMode;
    resetOtpState();
    form.reset();

    if (isLoginMode) {
      formTitle.textContent = 'Login ShooterSpaceW';
      labelConfirmPassword.style.display = 'none';
      confirmPasswordWrapper.style.display = 'none';
      otpContainer.style.display = 'none';
      submitBtnText.textContent = 'Login';
      toggleFormBtn.textContent = "Don't have an account? Register";
    } else {
      formTitle.textContent = 'Register ShooterSpaceW';
      labelConfirmPassword.style.display = 'block';
      confirmPasswordWrapper.style.display = 'flex';
      otpContainer.style.display = 'flex';
      submitBtnText.textContent = 'Register';
      toggleFormBtn.textContent = 'Already have an account? Login';
    }
    validateForm();
  });

  [emailInput, passwordInput, confirmPasswordInput, otpInput].forEach((input) => {
    input.addEventListener('input', () => {
      validateForm();
    });
  });

  function setLoading(isLoading) {
    if (isLoading) {
      submitBtn.disabled = true;
      submitBtn.classList.add('loading');
    } else {
      submitBtn.disabled = false;
      submitBtn.classList.remove('loading');
    }
  }

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    setLoading(true);

    const email = emailInput.value.trim();
    const password = passwordInput.value;

    if (isLoginMode) {
      auth.signInWithEmailAndPassword(email, password)
      .then(userCredential => {
        setLoading(false);
        showSuccess('Login successful! Redirecting...');
        setTimeout(() => {
          Swal.fire({
            icon: 'success',
            title: 'Welcome back!',
            text: `You are now logged in to ShooterSpaceW as ${userCredential.user.email}`,
            confirmButtonText: 'OK'
          }).then(() => {
            form.reset();
            resetOtpState();
          });
        }, 1500);
      })
      .catch(error => {
        setLoading(false);
        switch (error.code) {
          case 'auth/user-not-found':
            showError('User not found. Please register first.');
            break;
          case 'auth/wrong-password':
            showError('Incorrect password. Please try again.');
            break;
          case 'auth/invalid-email':
            showError('Invalid email format.');
            break;
          default:
            showError(`Login error: ${error.message}`);
        }
      });
    } else {
      if (!otpVerified) {
        setLoading(false);
        showError('Please verify OTP before registering.');
        return;
      }
      if (password !== confirmPasswordInput.value) {
        setLoading(false);
        showError('Passwords do not match.');
        return;
      }
      auth.createUserWithEmailAndPassword(email, password)
      .then(userCredential => {
        userCredential.user.updateProfile({ displayName: '' }).then(() => {
          setLoading(false);
          showSuccess('Registration successful! You can now login.');
          form.reset();
          resetOtpState();
          toggleFormBtn.click();
        });
      })
      .catch(error => {
        setLoading(false);
        switch (error.code) {
          case 'auth/email-already-in-use':
            showError('Email already in use. Please login.');
            break;
          case 'auth/invalid-email':
            showError('Invalid email format.');
            break;
          case 'auth/weak-password':
            showError('Weak password. Minimum 6 characters.');
            break;
          default:
            showError(`Registration error: ${error.message}`);
        }
      });
    }
  });

  toggleFormBtn.click();
</script>

</body>
</html>